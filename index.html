<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muratbey Ofis Saya√ß ve Depo Takip Sistemi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <meta name="theme-color" content="#1e2738">
    <style>
        /* Root Variables - Only Dark Theme */
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #f87171;
            --success-color: #4ade80;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --bg-color: #1f2937;
            --card-bg: #111827;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -4px rgba(0, 0, 0, 0.2);
            --transition: all 0.2s ease-in-out;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border-color);
            border-top-color: var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Header Styles */
        .header {
            background: var(--card-bg);
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            transition: var(--transition);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .logo {
            height: 50px;
            object-fit: contain;
        }
        
        .logo-text h1 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
        }
        
        .logo-text p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin: 0;
        }
        
        /* Navigation */
        .nav-menu {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        /* Theme Toggle */
        .theme-toggle {
            background: none;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .theme-toggle:hover {
            border-color: var(--secondary-color);
            transform: rotate(180deg);
        }
        
        /* User Menu */
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: var(--transition);
        }
        
        .user-info:hover {
            background: var(--bg-color);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            display: none;
            margin-top: 0.5rem;
            border: 1px solid var(--border-color);
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .user-dropdown-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border-color);
        }
        
        .user-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .user-dropdown-item:hover {
            background: var(--bg-color);
        }
        
        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 0.875rem;
        }
        
        .btn-primary {
            background: var(--secondary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #b91c1c;
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-secondary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .btn-outline:hover {
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }
        
        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: var(--shadow-lg);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: var(--transition);
            background: var(--card-bg);
            color: var(--text-primary);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(212, 47, 47, 0.1);
        }
        
        .form-input.error {
            border-color: var(--error-color);
        }
        
        .form-error {
            color: var(--error-color);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        /* Toast Notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .toast {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        }
        
        .toast.success {
            border-left: 4px solid var(--success-color);
        }
        
        .toast.error {
            border-left: 4px solid var(--error-color);
        }
        
        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Login Page */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-color);
            padding: 2rem;
        }
        
        .login-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .login-logo img {
            height: 80px;
            margin-bottom: 1rem;
        }
        
        .login-title {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 0.5rem;
        }
        
        .login-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        /* Dashboard */
        .dashboard {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
        }
        
        .tab:hover {
            background: var(--bg-color);
        }
        
        .tab.active {
            color: var(--secondary-color);
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--secondary-color);
        }
        
        /* Office Grid */
        .office-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .office-card {
            background-color: var(--card-bg, #2d3748);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .office-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
        }
        
        .office-card.complete {
            border-left: 4px solid var(--success-color, #28a745);
        }
        
        .office-card.incomplete {
            border-left: 4px solid var(--warning-color, #ffc107);
        }
        
        .office-card .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        
        .office-card .card-content {
            flex: 1;
            font-size: 0.9rem;
        }
        
        .office-card .card-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        .office-card.complete {
            border-color: var(--success-color);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .office-card.incomplete {
            border-color: var(--error-color);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .office-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .office-no {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .office-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .office-status.complete {
            background: var(--success-color);
        }
        
        .office-status.incomplete {
            background: var(--error-color);
        }
        
        .office-name {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        
        .office-meters {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .meter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .meter-item:last-child {
            border-bottom: none;
        }
        
        .meter-type {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .meter-value {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .meter-info {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: right;
        }
        
        .office-action {
            margin-top: 1rem;
            text-align: center;
        }
        
        /* Meter Entry Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        
        .modal-close:hover {
            background: var(--bg-color);
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        /* Meter Tabs */
        .meter-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--bg-color);
            padding: 0.25rem;
            border-radius: 8px;
        }
        
        .meter-tab {
            flex: 1;
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-weight: 500;
        }
        
        .meter-tab:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        .meter-tab.active {
            background: var(--card-bg);
            color: var(--secondary-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        /* User Management */
        .user-management {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
        
        .user-form-card {
            height: fit-content;
        }
        
        .user-list {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .user-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .user-list-title {
            font-size: 1.125rem;
            font-weight: 600;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .user-item-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .user-item-details {
            display: flex;
            flex-direction: column;
        }
        
        .user-item-name {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .user-item-role {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .user-item-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .stat-icon.primary {
            background: rgba(30, 39, 56, 0.1);
            color: var(--primary-color);
        }
        
        .stat-icon.success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success-color);
        }
        
        .stat-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }
        
        .stat-icon.error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            .dashboard {
                padding: 0 1rem;
            }
            
            .office-grid {
                grid-template-columns: 1fr;
            }
            
            .user-management {
                grid-template-columns: 1fr;
            }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--text-secondary);
        }
        
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .empty-state-text {
            margin-bottom: 1.5rem;
        }
        
        /* Search */
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text-primary);
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }
        
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .badge-success {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success-color);
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }
        
        .badge-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error-color);
        }
        
        /* History Styles */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .history-table th {
            background: var(--bg-color);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid var(--border-color);
        }
        
        .history-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .history-table tr:hover {
            background: var(--bg-color);
        }

        /* Warehouse Styles */
        .warehouse-subtab {
            margin-top: 1.5rem;
        }

        .table-responsive {
            overflow-x: auto;
            width: 100%;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-color);
            border: none;
            color: var(--text-primary);
        }

        .action-btn:hover {
            background: var(--border-color);
        }

        .action-btn.edit {
            color: var(--primary-color);
        }

        .action-btn.delete {
            color: var(--error-color);
        }

        .inventory-category {
            margin-bottom: 2rem;
        }

        .inventory-category-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--border-color);
            color: var(--primary-color);
        }

        .office-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .office-category-item {
            background: var(--card-bg);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }

        .office-category-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .history-type {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-color);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Login Page -->
    <div id="loginPage" class="login-page">
        <div class="login-card">
            <div class="login-logo">
                <img src="gti-logo.svg" alt="GTƒ∞ Logo">
            </div>
            <h1 class="login-title">Muratbey</h1>
            <p class="login-subtitle">Ofis Saya√ß ve Depo Takip Sistemi</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="username">Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" class="form-input" id="username" required autocomplete="username">
                    <span class="form-error" id="usernameError"></span>
                </div>
                <div class="form-group">
                    <label class="form-label" for="password">≈ûifre</label>
                    <input type="password" class="form-input" id="password" required autocomplete="current-password">
                    <span class="form-error" id="passwordError"></span>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    Giri≈ü Yap
                </button>
            </form>
            
            <div style="margin-top: 2rem; text-align: center;">
                <small style="color: var(--text-secondary);">
                    Sorun ya≈üƒ±yorsanƒ±z 
                    <a href="#" onclick="clearLocalStorage()" style="color: var(--secondary-color);">
                        verileri temizleyin
                    </a>
                </small>
                <div style="margin-top: 1rem;">
                    <small style="color: var(--text-secondary);">
                        Test kullanƒ±cƒ±larƒ±:<br>
                        admin / admin123<br>
                        teknik / teknik123
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo-container">
                    <img src="gti-logo.svg" alt="GTƒ∞ Logo" class="logo">
                    <div class="logo-text">
                        <h1>Muratbey</h1>
                        <p>Ofis Saya√ß ve Depo Takip Sistemi</p>
                    </div>
                </div>
                <nav class="nav-menu">
                    <button class="theme-toggle" id="themeToggle">
                        <span id="themeIcon">üåô</span>
                    </button>
                    <div class="user-menu">
                        <div class="user-info" id="userInfo">
                            <div class="user-avatar" id="userAvatar">T</div>
                            <div>
                                <div style="font-weight: 500;" id="userName">Kullanƒ±cƒ±</div>
                                <div style="font-size: 0.75rem; color: var(--text-secondary);" id="userRole">Teknik</div>
                            </div>
                        </div>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-dropdown-item" id="userManagementBtn" style="display: none; cursor: pointer;">
                                <span>üë•</span> Kullanƒ±cƒ± Y√∂netimi
                            </div>
                            <div class="user-dropdown-item" id="logoutBtn">
                                <span>üö™</span> √áƒ±kƒ±≈ü Yap
                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Dashboard -->
        <main class="dashboard">
            <!-- Tabs -->
            <div class="tabs" id="mainTabs">
                <div class="tab active" data-tab="offices">
                    <span>üè¢</span> Ofis Saya√ßlarƒ±
                </div>
                <div class="tab" data-tab="warehouse">
                    <span>üì¶</span> Depo Y√∂netimi
                </div>
                <div class="tab" data-tab="stats">
                    <span>üìä</span> ƒ∞statistikler
                </div>
            </div>

            <!-- Office Tab Content -->
            <div id="officesTab" class="tab-content">
                <!-- Search -->
                <div class="search-container">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" id="officeSearch" placeholder="Ofis ara...">
                </div>

                <!-- Office Grid -->
                <div class="office-grid" id="officeGrid">
                    <!-- Office cards will be populated here -->
                </div>
            </div>

            <!-- Warehouse Tab Content -->
            <div id="warehouseTab" class="tab-content" style="display: none;">
                <div class="tabs">
                    <div class="tab active" data-tab="inventory">
                        <span>üìú</span> Envanter
                    </div>
                    <div class="tab" data-tab="warehouseManagement">
                        <span>üè¢</span> Depo Y√∂netimi
                    </div>
                    <div class="tab" data-tab="importExport">
                        <span>üì•</span> ƒ∞√ße/Dƒ±≈üa Aktar
                    </div>
                </div>

                <!-- Inventory Content -->
                <div id="inventoryContent" class="warehouse-subtab">
                    <!-- Search -->
                    <div class="search-container">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="inventorySearch" placeholder="√úr√ºn ara...">
                    </div>

                    <!-- Warehouse Selection -->
                    <div class="form-group">
                        <label class="form-label" for="warehouseSelect">Depo Se√ßin</label>
                        <select class="form-input" id="warehouseSelect">
                            <option value="all">T√ºm Depolar</option>
                            <!-- Warehouse options will be populated here -->
                        </select>
                    </div>

                    <!-- Inventory Table -->
                    <div class="card" style="margin-top: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                            <h3>Envanter Listesi</h3>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-primary" id="addProductBtn">
                                    <span>‚ûï</span> √úr√ºn Ekle
                                </button>
                                <button class="btn btn-primary" id="exportInventoryBtn">
                                    <span>üíæ</span> Excel'e Aktar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="history-table" id="inventoryTable">
                                <thead>
                                    <tr>
                                        <th>√úr√ºn Kodu</th>
                                        <th>√úr√ºn Adƒ±</th>
                                        <th>Depo</th>
                                        <th>Miktar</th>
                                        <th>Birim</th>
                                        <th>Son G√ºncelleme</th>
                                        <th>ƒ∞≈ülemler</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTableBody">
                                    <!-- Inventory items will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Warehouse Management Content -->
                <div id="warehouseManagementContent" class="warehouse-subtab" style="display: none;">
                    <div class="user-management">
                        <!-- Warehouse Form -->
                        <div class="card user-form-card">
                            <h3 style="margin-bottom: 1.5rem;">Depo Y√∂netimi</h3>
                            <form id="warehouseForm">
                                <div class="form-group">
                                    <label class="form-label" for="warehouseName">Depo Adƒ±</label>
                                    <input type="text" class="form-input" id="warehouseName" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="warehouseDescription">A√ßƒ±klama</label>
                                    <input type="text" class="form-input" id="warehouseDescription">
                                </div>
                                <input type="hidden" id="warehouseId" value="">
                                <div style="display: flex; gap: 0.5rem;">
                                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                                        <span id="warehouseFormBtn">Depo Ekle</span>
                                    </button>
                                    <button type="button" class="btn btn-outline" id="warehouseFormReset" style="display: none;">
                                        ƒ∞ptal
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- Warehouse List -->
                        <div class="user-list">
                            <div class="user-list-header">
                                <h3 class="user-list-title">Mevcut Depolar</h3>
                                <span class="badge badge-success" id="warehouseCount">0 Depo</span>
                            </div>
                            <div id="warehouseList">
                                <!-- Warehouse list will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Import/Export Content -->
                <div id="importExportContent" class="warehouse-subtab" style="display: none;">
                    <div class="card" style="margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;">Toplu √úr√ºn Giri≈üi</h3>
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                            Excel dosyasƒ± kullanarak toplu √ºr√ºn giri≈üi yapabilirsiniz. √ñnce ≈üablonu indirin, doldurun ve y√ºkleme yapƒ±n.
                        </p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <a href="#" class="btn btn-outline" id="downloadTemplateBtn">
                                <span>üíæ</span> Excel ≈ûablonunu ƒ∞ndir
                            </a>
                            <label for="excelFileInput" class="btn btn-primary">
                                <span>üìù</span> Excel Dosyasƒ± Y√ºkle
                            </label>
                            <input type="file" id="excelFileInput" style="display: none;" accept=".xlsx, .xls">
                        </div>
                    </div>

                    <div class="card">
                        <h3 style="margin-bottom: 1rem;">Raporlar</h3>
                        <p style="margin-bottom: 1rem; color: var(--text-secondary);">
                            Sistem verilerini Excel raporu olarak indirebilirsiniz.
                        </p>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-outline" id="exportInventoryReportBtn">
                                <span>üìä</span> Envanter Raporu
                            </button>
                            <button class="btn btn-outline" id="exportMeterReportBtn">
                                <span>üìà</span> Saya√ß Raporu
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Tab Content -->
            <div id="statsTab" class="tab-content" style="display: none;">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">üè¢</div>
                        <div class="stat-value" id="totalOffices">0</div>
                        <div class="stat-label">Toplam Ofis</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">‚úì</div>
                        <div class="stat-value" id="completedOffices">0</div>
                        <div class="stat-label">Tamamlanan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon error">‚è∞</div>
                        <div class="stat-value" id="pendingOffices">0</div>
                        <div class="stat-label">Bekleyen</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">üìà</div>
                        <div class="stat-value" id="completionRate">0%</div>
                        <div class="stat-label">Tamamlanma Oranƒ±</div>
                    </div>
                </div>
            </div>

            <!-- User Management Tab Content -->
            <div id="userManagementTab" class="tab-content" style="display: none;">
                <div class="user-management">
                    <!-- User Creation Form -->
                    <div class="card user-form-card">
                        <h3 style="margin-bottom: 1.5rem;">Yeni Kullanƒ±cƒ± Ekle</h3>
                        <form id="userForm">
                            <div class="form-group">
                                <label class="form-label" for="newUsername">Kullanƒ±cƒ± Adƒ±</label>
                                <input type="text" class="form-input" id="newUsername" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="newPassword">≈ûifre</label>
                                <input type="password" class="form-input" id="newPassword" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="newFullName">Ad Soyad</label>
                                <input type="text" class="form-input" id="newFullName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="newRole">Rol</label>
                                <select class="form-input" id="newRole" required>
                                    <option value="teknik">Teknik Personel</option>
                                    <option value="depo">Depo Personeli</option>
                                    <option value="admin">Y√∂netici</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                Kullanƒ±cƒ± Ekle
                            </button>
                        </form>
                    </div>

                    <!-- User List -->
                    <div class="user-list">
                        <div class="user-list-header">
                            <h3 class="user-list-title">Mevcut Kullanƒ±cƒ±lar</h3>
                            <span class="badge badge-success" id="userCount">0 Kullanƒ±cƒ±</span>
                        </div>
                        <div id="userList">
                            <!-- User list will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Meter Entry Modal -->
    <div class="modal" id="meterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="meterModalTitle">Saya√ß Giri≈üi</h2>
                <button class="modal-close" onclick="closeModal('meterModal')">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Meter Type Tabs -->
                <div class="meter-tabs">
                    <div class="meter-tab active" data-meter="electric" onclick="switchMeterTab('electric')">
                        <span>‚ö°</span> Elektrik
                    </div>
                    <div class="meter-tab" data-meter="water" onclick="switchMeterTab('water')">
                        <span>üíß</span> Su
                    </div>
                    <div class="meter-tab" data-meter="gas" onclick="switchMeterTab('gas')">
                        <span>üî•</span> Doƒüalgaz
                    </div>
                </div>

                <!-- Meter Forms -->
                <form id="meterForm">
                    <input type="hidden" id="currentOfficeId">
                    
                    <!-- Electric Meter -->
                    <div id="electricMeterForm" class="meter-form">
                        <div class="form-group">
                            <label class="form-label" for="electricReading">Elektrik Saya√ß Deƒüeri (kWh)</label>
                            <input type="number" class="form-input" id="electricReading" step="0.01" min="0">
                        </div>
                    </div>

                    <!-- Water Meter -->
                    <div id="waterMeterForm" class="meter-form" style="display: none;">
                        <div class="form-group">
                            <label class="form-label" for="waterReading">Su Saya√ß Deƒüeri (m¬≥)</label>
                            <input type="number" class="form-input" id="waterReading" step="0.01" min="0">
                        </div>
                    </div>

                    <!-- Gas Meter -->
                    <div id="gasMeterForm" class="meter-form" style="display: none;">
                        <div class="form-group">
                            <label class="form-label" for="gasReading">Doƒüalgaz Saya√ß Deƒüeri (m¬≥)</label>
                            <input type="number" class="form-input" id="gasReading" step="0.01" min="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('meterModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="saveMeterReading()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="historyModalTitle">Saya√ß Ge√ßmi≈üi</h2>
                <button class="modal-close" onclick="closeModal('historyModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="historyContent">
                    <!-- History will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('historyModal')">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="productModalTitle">Yeni √úr√ºn Ekle</h2>
                <button class="modal-close" onclick="closeModal('productModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <div class="form-group">
                        <label class="form-label" for="productCode">√úr√ºn Kodu</label>
                        <input type="text" class="form-input" id="productCode" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="productName">√úr√ºn Adƒ±</label>
                        <input type="text" class="form-input" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="productWarehouse">Depo</label>
                        <select id="productWarehouse" class="form-input" required>
                            <option value="">Depo Se√ßiniz</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="productQuantity">Miktar</label>
                        <input type="number" id="productQuantity" class="form-input" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="productUnit">Birim</label>
                        <select id="productUnit" class="form-input">
                            <option value="Adet">Adet</option>
                            <option value="Kg">Kilogram</option>
                            <option value="Lt">Litre</option>
                            <option value="Mt">Metre</option>
                            <option value="Paket">Paket</option>
                            <option value="Kutu">Kutu</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="productDescription">A√ßƒ±klama</label>
                        <textarea class="form-input" id="productDescription" rows="3"></textarea>
                    </div>
                    <input type="hidden" id="productId" value="">
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('productModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" id="saveProductBtn">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Inventory History Modal -->
    <div class="modal" id="inventoryHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="inventoryHistoryModalTitle">√úr√ºn Hareketi Ge√ßmi≈üi</h2>
                <button class="modal-close" onclick="closeModal('inventoryHistoryModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div id="inventoryHistoryContent">
                    <!-- Inventory history will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('inventoryHistoryModal')">Kapat</button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const AppState = {
            data: {
                currentUser: null,
                offices: [],
                users: [],
                meterReadings: [],
                warehouses: [],
                inventory: [],
                currentTheme: 'light'
            },
            
            setState(newState) {
                this.data = { ...this.data, ...newState };
                this.saveToLocalStorage();
            },
            
            saveToLocalStorage() {
                try {
                    localStorage.setItem('appState', JSON.stringify(this.data));
                } catch (e) {
                    console.warn('LocalStorage save failed:', e);
                }
            },
            
            loadFromLocalStorage() {
                try {
                    const saved = localStorage.getItem('appState');
                    if (saved) {
                        const parsedData = JSON.parse(saved);
                        if (parsedData && typeof parsedData === 'object') {
                            // Don't overwrite users with empty array
                            if (parsedData.users && parsedData.users.length === 0) {
                                delete parsedData.users;
                            }
                            this.data = { ...this.data, ...parsedData };
                        }
                    }
                } catch (e) {
                    console.warn('LocalStorage load failed:', e);
                    // Clear corrupted data
                    localStorage.removeItem('appState');
                }
            }
        };

        // Utility Functions
        function $(selector) {
            return document.querySelector(selector);
        }

        function $$(selector) {
            return document.querySelectorAll(selector);
        }

        function showToast(message, type = 'success') {
            const toastContainer = $('#toastContainer');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚ö†Ô∏è'}</span>
                <span>${message}</span>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showModal(modalId) {
            const modal = $(`#${modalId}`);
            if (modal) modal.classList.add('show');
        }

        function closeModal(modalId) {
            const modal = $(`#${modalId}`);
            if (modal) modal.classList.remove('show');
        }

        function hashPassword(password) {
            // Simple hash for demo - use bcrypt in production
            return btoa(password);
        }

        function verifyPassword(password, hash) {
            return hashPassword(password) === hash;
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('tr-TR');
        }

        function formatDateTime(date) {
            return new Date(date).toLocaleString('tr-TR');
        }

        // Theme System
        function setTheme(theme) {
            // Always use dark theme regardless of input
            document.documentElement.setAttribute('data-theme', 'dark');
            AppState.setState({ currentTheme: 'dark' });
            
            const themeIcon = $('#themeIcon');
            if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
        }
        
        // Toggle Theme - now only sets dark theme
        function toggleTheme() {
            setTheme('dark');
        }

        // Initialize Default Users
        function initializeUsers() {
            const defaultUsers = [
                {
                    username: 'admin',
                    password: hashPassword('admin123'),
                    fullName: 'Sistem Y√∂neticisi',
                    role: 'admin'
                },
                {
                    username: 'teknik',
                    password: hashPassword('teknik123'),
                    fullName: 'Teknik Personel',
                    role: 'teknik'
                },
                {
                    username: 'depo',
                    password: hashPassword('depo123'),
                    fullName: 'Depo Personeli',
                    role: 'depo'
                }
            ];
            
            AppState.setState({ users: defaultUsers });
        }
        
        // Initialize Default Warehouses
        function initializeWarehouses() {
            const defaultWarehouses = [
                {
                    id: '1',
                    name: 'SARI OTOPARK 5 NOLU DEPO',
                    description: 'Ana depo alanƒ±'
                },
                {
                    id: '2',
                    name: 'SARI OTOPARK PEYZAJ DEPOSU',
                    description: 'Peyzaj malzemeleri deposu'
                },
                {
                    id: '3',
                    name: 'YE≈ûƒ∞L OTOPARK DEPO',
                    description: 'Ye≈üil otopark b√∂lgesi deposu'
                },
                {
                    id: '4',
                    name: 'YAKIT DEPOSU',
                    description: 'Yakƒ±t ve petrol √ºr√ºnleri deposu'
                },
                {
                    id: '5',
                    name: 'YE≈ûƒ∞L OTOPARK 5 NOLU DEPO',
                    description: 'Ye≈üil otopark 5 numaralƒ± depo'
                },
                {
                    id: '6',
                    name: 'ZEMƒ∞N 30 OFƒ∞S',
                    description: 'Zemin kat 30 numaralƒ± ofis deposu'
                },
                {
                    id: '7',
                    name: '-1.KAT DEPO',
                    description: 'Birinci bodrum kat deposu'
                },
                {
                    id: '8',
                    name: 'ZEMƒ∞N KAT DEPO',
                    description: 'Zemin kat ana depo'
                },
                {
                    id: '9',
                    name: 'ƒ∞≈ûLETME DEPO',
                    description: 'ƒ∞≈ületme i√ßin kullanƒ±lan depo'
                },
                {
                    id: '10',
                    name: 'TEKNƒ∞K DEPO',
                    description: 'Teknik malzemeler deposu'
                }
            ];
            
            // Only initialize if warehouses are empty
            if (AppState.data.warehouses.length === 0) {
                AppState.setState({ warehouses: defaultWarehouses });
            }
        }

        // Load Offices from JSON
        async function loadOffices() {
            try {
                // For demo, we'll use hardcoded data with new format
                const offices = [
                    { 
                        id: "1", 
                        office_no: "1B-21", 
                        name: "Halit Demirkan", 
                        electric: { meter_no: "39296823", last_reading: 0 },
                        water: { meter_no: "5185306", last_reading: 0 },
                        history: []
                    },
                    { 
                        id: "2", 
                        office_no: "1B-20", 
                        name: "His G√ºmr√ºk M√º≈üavirliƒüi LTD.≈ûTƒ∞.", 
                        electric: { meter_no: "39297205", last_reading: 0 },
                        water: { meter_no: "5185291", last_reading: 0 },
                        history: []
                    },
                    { 
                        id: "3", 
                        office_no: "1B-19", 
                        name: "", 
                        electric: { meter_no: "", last_reading: 0 },
                        water: { meter_no: "5185285", last_reading: 0 },
                        history: []
                    },
                    { 
                        id: "4", 
                        office_no: "1B-18", 
                        name: "Narin G√ºmr√ºk M√º≈üavirliƒüi", 
                        electric: { meter_no: "39296915", last_reading: 0 },
                        water: { meter_no: "5185331", last_reading: 0 },
                        history: []
                    },
                    { 
                        id: "5", 
                        office_no: "1B-17", 
                        name: "OMN G√ºmr√ºk M√º≈üavirliƒüi LTD.≈ûTƒ∞.", 
                        electric: { meter_no: "39296908", last_reading: 0 },
                        water: { meter_no: "", last_reading: 0 },
                        history: []
                    }
                ];
                
                AppState.setState({ offices });
                
                // In production, uncomment this:
                // const response = await fetch('offices.json');
                // const offices = await response.json();
                // AppState.setState({ offices });
            } catch (error) {
                console.error('Error loading offices:', error);
                showToast('Ofis verileri y√ºklenemedi', 'error');
            }
        }

        // Authentication
        function handleLogin(e) {
            e.preventDefault();
            
            const username = $('#username').value.trim();
            const password = $('#password').value.trim();
            
            // Clear errors
            $('#usernameError').textContent = '';
            $('#passwordError').textContent = '';
            
            // Validation
            if (!username) {
                $('#usernameError').textContent = 'Kullanƒ±cƒ± adƒ± gereklidir';
                return;
            }
            
            if (!password) {
                $('#passwordError').textContent = '≈ûifre gereklidir';
                return;
            }
            
            // Debug: Show current users
            console.log('Available users:', AppState.data.users);
            
            // Find user
            const user = AppState.data.users.find(u => 
                u.username === username && verifyPassword(password, u.password)
            );
            
            if (user) {
                AppState.setState({ currentUser: user });
                showDashboard();
                showToast(`Ho≈ü geldiniz, ${user.fullName}!`, 'success');
            } else {
                $('#passwordError').textContent = 'Ge√ßersiz kullanƒ±cƒ± adƒ± veya ≈üifre';
                console.log('Login failed for:', username);
            }
        }

        function handleLogout() {
            AppState.setState({ currentUser: null });
            showLoginPage();
            showToast('Ba≈üarƒ±yla √ßƒ±kƒ±≈ü yaptƒ±nƒ±z', 'success');
        }

        // Page Navigation
        function showLoginPage() {
            $('#loginPage').style.display = 'flex';
            $('#app').style.display = 'none';
        }

        function showDashboard() {
            $('#loginPage').style.display = 'none';
            $('#app').style.display = 'block';
            
            // Update user info
            const user = AppState.data.currentUser;
            $('#userName').textContent = user.fullName;
            
            // Update role display
            let roleDisplay = '';
            switch(user.role) {
                case 'admin':
                    roleDisplay = 'Y√∂netici';
                    break;
                case 'teknik':
                    roleDisplay = 'Teknik Personel';
                    break;
                case 'depo':
                    roleDisplay = 'Depo Personeli';
                    break;
                default:
                    roleDisplay = user.role;
            }
            
            $('#userRole').textContent = roleDisplay;
            $('#userAvatar').textContent = user.fullName.charAt(0).toUpperCase();
            
            // Handle role-based access control
            if (user.role === 'admin') {
                // Admin can access everything
                $('#userManagementBtn').style.display = 'flex';
                $$('.tab').forEach(tab => tab.style.display = 'flex');
            } else if (user.role === 'teknik') {
                // Teknik can only access offices tab
                $('#userManagementBtn').style.display = 'none';
                $$('.tab').forEach(tab => {
                    if (tab.getAttribute('data-tab') === 'offices') {
                        tab.style.display = 'flex';
                    } else {
                        tab.style.display = 'none';
                    }
                });
            } else if (user.role === 'depo') {
                // Depo can only access warehouse tab
                $('#userManagementBtn').style.display = 'none';
                $$('.tab').forEach(tab => {
                    if (tab.getAttribute('data-tab') === 'warehouse') {
                        tab.style.display = 'flex';
                    } else {
                        tab.style.display = 'none';
                    }
                });
            }
            
            // Initialize warehouses if needed
            initializeWarehouses();
            
            // Load data based on role
            if (user.role === 'admin' || user.role === 'teknik') {
                renderOffices();
                updateStats();
            }
            
            if (user.role === 'admin' || user.role === 'depo') {
                renderWarehouses();
                renderInventory();
            }
            
            // Set active tab based on role
            if (user.role === 'depo') {
                changeTab('warehouse');
            } else {
                changeTab('offices');
            }
        }

        // Tab switching function
        function changeTab(tabId) {
            // Hide all tab contents
            $$('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Remove active class from all tabs
            $$('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            $(`#${tabId}Tab`).style.display = 'block';
            
            // Add active class to selected tab
            $$('.tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
        }

        // Office Categories
        window.OFFICE_CATEGORIES = [
            { id: 'cat100', name: '100 Numaralƒ± Ofisler' },
            { id: 'cat1b', name: '1B Blok Ofisleri' },
            { id: 'cat20', name: '20 Blok Ofisleri' },
            { id: 'cat20a', name: '20A Blok Ofisleri' },
            { id: 'cat2b', name: '2B Blok Ofisleri' },
            { id: 'cat2b01', name: '2B01 Blok Ofisleri' },
            { id: 'cat3b', name: '3B Blok Ofisleri' },
            { id: 'catAtm', name: 'ATM Bloklarƒ±' },
            { id: 'catId', name: 'ID Blok Ofisleri' },
            { id: 'catMd1', name: 'MD1 Blok Ofisleri' },
            { id: 'catMd2', name: 'MD2 Blok Ofisleri' },
            { id: 'catSd1', name: 'SD1 Blok Ofisleri' },
            { id: 'catSd2', name: 'SD2 Blok Ofisleri' }
        ];

        // Get category for an office
        function getOfficeCategory(officeNo) {
            if (!officeNo) return OFFICE_CATEGORIES[0];
            
            const officeLower = officeNo.toLowerCase();
            
            if (officeLower.includes('100')) return OFFICE_CATEGORIES[0];
            if (officeLower.includes('1b')) return OFFICE_CATEGORIES[1];
            if (officeLower.includes('20a')) return OFFICE_CATEGORIES[3];
            if (officeLower.includes('20')) return OFFICE_CATEGORIES[2];
            if (officeLower.includes('2b01')) return OFFICE_CATEGORIES[5];
            if (officeLower.includes('2b')) return OFFICE_CATEGORIES[4];
            if (officeLower.includes('3b')) return OFFICE_CATEGORIES[6];
            if (officeLower.includes('atm')) return OFFICE_CATEGORIES[7];
            if (officeLower.includes('id')) return OFFICE_CATEGORIES[8];
            if (officeLower.includes('md1')) return OFFICE_CATEGORIES[9];
            if (officeLower.includes('md2')) return OFFICE_CATEGORIES[10];
            if (officeLower.includes('sd1')) return OFFICE_CATEGORIES[11];
            if (officeLower.includes('sd2')) return OFFICE_CATEGORIES[12];
            
            // Default to first category if no match
            return OFFICE_CATEGORIES[0];
        }

        // Office Categories
        window.OFFICE_CATEGORIES = [
            { id: 'cat100', name: '100 Numaralƒ± Ofisler' },
            { id: 'cat1b', name: '1B Blok Ofisleri' },
            { id: 'cat20', name: '20 Blok Ofisleri' },
            { id: 'cat20a', name: '20A Blok Ofisleri' },
            { id: 'cat2b', name: '2B Blok Ofisleri' },
            { id: 'cat2b01', name: '2B01 Blok Ofisleri' },
            { id: 'cat3b', name: '3B Blok Ofisleri' },
            { id: 'catAtm', name: 'ATM Bloklarƒ±' },
            { id: 'catId', name: 'ID Blok Ofisleri' },
            { id: 'catMd1', name: 'MD1 Blok Ofisleri' },
            { id: 'catMd2', name: 'MD2 Blok Ofisleri' },
            { id: 'catSd1', name: 'SD1 Blok Ofisleri' },
            { id: 'catSd2', name: 'SD2 Blok Ofisleri' }
        ];

        // Get category for an office
        function getOfficeCategory(officeNo) {
            officeNo = officeNo.toLowerCase();
            
            if (officeNo.includes('100')) return OFFICE_CATEGORIES[0];
            if (officeNo.includes('1b')) return OFFICE_CATEGORIES[1];
            if (officeNo.includes('20a')) return OFFICE_CATEGORIES[3];
            if (officeNo.includes('20')) return OFFICE_CATEGORIES[2];
            if (officeNo.includes('2b01')) return OFFICE_CATEGORIES[5];
            if (officeNo.includes('2b')) return OFFICE_CATEGORIES[4];
            if (officeNo.includes('3b')) return OFFICE_CATEGORIES[6];
            if (officeNo.includes('atm')) return OFFICE_CATEGORIES[7];
            if (officeNo.includes('id')) return OFFICE_CATEGORIES[8];
            if (officeNo.includes('md1')) return OFFICE_CATEGORIES[9];
            if (officeNo.includes('md2')) return OFFICE_CATEGORIES[10];
            if (officeNo.includes('sd1')) return OFFICE_CATEGORIES[11];
            if (officeNo.includes('sd2')) return OFFICE_CATEGORIES[12];
            
            // Default to first category if no match
            return OFFICE_CATEGORIES[0];
        }

        // Get category name by ID
        function getCategoryName(categoryId) {
            const category = OFFICE_CATEGORIES.find(c => c.id === categoryId);
            return category ? category.name : 'Diƒüer';
        }
    return OFFICE_CATEGORIES[0];


// Get category name by ID
function getCategoryName(categoryId) {
    const category = OFFICE_CATEGORIES.find(c => c.id === categoryId);
    return category ? category.name : 'Diƒüer';
}

// Render Offices
function renderOffices(offices = AppState.data.offices) {
    const officeGrid = $('#officeGrid');
    const officeSearchInput = $('#officeSearch');
    const productSearchInput = $('#productSearch');
    
    // Add badge styles if they don't exist
    if (!$('#badgeStyles')) {
        const style = document.createElement('style');
        style.id = 'badgeStyles';
        style.textContent = `
            .badge {
                display: inline-block;
                padding: 0.25em 0.6em;
                font-size: 0.75rem;
                font-weight: 600;
                line-height: 1;
                text-align: center;
                white-space: nowrap;
                vertical-align: baseline;
                border-radius: 10px;
            }
            .badge-success {
                background-color: var(--success-color, #28a745);
                color: white;
            }
            .badge-warning {
                background-color: var(--warning-color, #ffc107);
                color: #212529;
            }
            .text-muted {
                color: var(--muted-color, #6c757d);
                font-weight: 600;
                margin-right: 5px;
            }
            .btn-small {
                padding: 0.25rem 0.5rem;
                font-size: 0.8rem;
            }
        `;
        document.head.appendChild(style);
    }
    
    if (productSearchInput) {
        productSearchInput.addEventListener('input', () => {
            const query = productSearchInput.value.toLowerCase().trim();
            const products = AppState.data.inventory || [];
            
            // If query is empty, show all products
            if (!query) {
                renderInventory(products);
                return;
            }
            
            // Filter products by name, code, or warehouse
            const filteredProducts = products.filter(product => 
                (product.name && product.name.toLowerCase().includes(query)) || 
                (product.code && product.code.toLowerCase().includes(query)) || 
                (product.warehouse && product.warehouse.toLowerCase().includes(query))
            );
            
            renderInventory(filteredProducts);
        });
    }
    
    if (officeSearchInput) {
        officeSearchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase().trim();
            const filteredOffices = offices.filter(office => 
                (office.office_no && office.office_no.toLowerCase().includes(query)) || 
                (office.name && office.name.toLowerCase().includes(query))
            );
            
            renderOffices(filteredOffices);
        });
    }
    
    const searchTerm = officeSearchInput?.value?.toLowerCase() || '';
    let filteredOffices = offices;
    
    if (searchTerm) {
        filteredOffices = filteredOffices.filter(office => 
            (office.office_no && office.office_no.toLowerCase().includes(searchTerm)) ||
            (office.name && office.name.toLowerCase().includes(searchTerm))
        );
        
        // Render all matching offices in a flat list
        officeGrid.innerHTML = `<div class="office-grid">${filteredOffices.map(office => {
            const readings = getOfficeReadings(office.id);
            const isComplete = readings.electric || readings.water || readings.gas;
            
            return `
                <div class="office-card ${isComplete ? 'complete' : 'incomplete'}">
                    <div class="card-title">${office.office_no}</div>
                    <div class="card-content">
                        <div><span class="text-muted">Durum:</span> ${isComplete ? '<span class="badge badge-success">G√ºncel</span>' : '<span class="badge badge-warning">Bekliyor</span>'}</div>
                        <div><span class="text-muted">Kategori:</span> ${getCategoryName(office.category)}</div>
                        <div><span class="text-muted">Konum:</span> ${office.location || 'Belirtilmemi≈ü'}</div>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-small btn-primary" onclick="openMeterModal('${office.id}')">Saya√ß Ekle</button>
                        <button class="btn btn-small btn-outline" onclick="openHistoryModal('${office.id}')">Ge√ßmi≈ü</button>
                    </div>
                </div>
            `;
        }).join('')}</div>`;
    } else {
        // Clear the container first
        officeGrid.innerHTML = '';
        
        // Group offices by category
        const officesByCategory = {};
        
        // Initialize categories
        OFFICE_CATEGORIES.forEach(category => {
            officesByCategory[category.id] = {
                name: category.name,
                offices: []
            };
        });
        
        // Group offices
        filteredOffices.forEach(office => {
            const category = getOfficeCategory(office.office_no);
            if (category && category.id) {
                officesByCategory[category.id].offices.push(office);
            }
        });
        
        // Generate HTML for each category
        OFFICE_CATEGORIES.forEach(category => {
            const categoryData = officesByCategory[category.id];
            
            if (categoryData.offices.length > 0) {
                // Create a category container
                const categoryContainer = document.createElement('div');
                categoryContainer.className = 'inventory-category';
                
                // Add category title
                const categoryTitle = document.createElement('h3');
                categoryTitle.className = 'inventory-category-title';
                categoryTitle.textContent = categoryData.name;
                categoryContainer.appendChild(categoryTitle);
                
                // Create office grid for this category
                const categoryGrid = document.createElement('div');
                categoryGrid.className = 'office-grid';
                
                // Add office cards to the grid
                categoryData.offices.forEach(office => {
                    const readings = getOfficeReadings(office.id);
                    const isComplete = readings.electric || readings.water || readings.gas;
                    
                    // Create office card
                    const card = document.createElement('div');
                    card.className = `office-card ${isComplete ? 'complete' : 'incomplete'}`;
                    
                    // Card title
                    const cardTitle = document.createElement('div');
                    cardTitle.className = 'card-title';
                    cardTitle.textContent = office.office_no;
                    card.appendChild(cardTitle);
                    
                    // Card content
                    const cardContent = document.createElement('div');
                    cardContent.className = 'card-content';
                    
                    // Status
                    const statusDiv = document.createElement('div');
                    const statusLabel = document.createElement('span');
                    statusLabel.className = 'text-muted';
                    statusLabel.textContent = 'Durum:';
                    statusDiv.appendChild(statusLabel);
                    
                    const statusBadge = document.createElement('span');
                    statusBadge.className = isComplete ? 'badge badge-success' : 'badge badge-warning';
                    statusBadge.textContent = isComplete ? 'G√ºncel' : 'Bekliyor';
                    statusDiv.appendChild(document.createTextNode(' '));
                    statusDiv.appendChild(statusBadge);
                    cardContent.appendChild(statusDiv);
                    
                    // Category
                    const categoryDiv = document.createElement('div');
                    const categoryLabel = document.createElement('span');
                    categoryLabel.className = 'text-muted';
                    categoryLabel.textContent = 'Kategori:';
                    categoryDiv.appendChild(categoryLabel);
                    categoryDiv.appendChild(document.createTextNode(' ' + getCategoryName(office.category)));
                    cardContent.appendChild(categoryDiv);
                    
                    // Location
                    const locationDiv = document.createElement('div');
                    const locationLabel = document.createElement('span');
                    locationLabel.className = 'text-muted';
                    locationLabel.textContent = 'Konum:';
                    locationDiv.appendChild(locationLabel);
                    locationDiv.appendChild(document.createTextNode(' ' + (office.location || 'Belirtilmemi≈ü')));
                    cardContent.appendChild(locationDiv);
                    
                    card.appendChild(cardContent);
                    
                    // Card actions
                    const cardActions = document.createElement('div');
                    cardActions.className = 'card-actions';
                    
                    // Add meter button
                    const addButton = document.createElement('button');
                    addButton.className = 'btn btn-small btn-primary';
                    addButton.textContent = 'Saya√ß Ekle';
                    addButton.onclick = function() { openMeterModal(office.id); };
                    cardActions.appendChild(addButton);
                    
                    // History button
                    const historyButton = document.createElement('button');
                    historyButton.className = 'btn btn-small btn-outline';
                    historyButton.textContent = 'Ge√ßmi≈ü';
                    historyButton.onclick = function() { openHistoryModal(office.id); };
                    cardActions.appendChild(historyButton);
                    
                    card.appendChild(cardActions);
                    
                    // Add the card to the grid
                    categoryGrid.appendChild(card);
                });
                
                // Add the grid to the category container
                categoryContainer.appendChild(categoryGrid);
                
                // Add the category to the main container
                officeGrid.appendChild(categoryContainer);
            }
                });
                
                // Add the grid to the category container
                categoryContainer.appendChild(categoryGrid);
                
                // Add the category to the main container
                officeGrid.appendChild(categoryContainer);
            }
        };
            
            const completedOffices = new Set(todayReadings.map(r => r.officeId)).size;
            const totalOffices = offices.length;
            const pendingOffices = totalOffices - completedOffices;
            const completionRate = totalOffices > 0 ? Math.round((completedOffices / totalOffices) * 100) : 0;
            
            $('#totalOffices').textContent = totalOffices;
            $('#completedOffices').textContent = completedOffices;
            $('#pendingOffices').textContent = pendingOffices;
            $('#completionRate').textContent = completionRate + '%';
        

        // Switch between meter tabs
        function switchMeterTab(meterType) {
            // Hide all meter forms
            $$('.meter-form').forEach(form => form.style.display = 'none');
            
            // Show the selected meter form
            $(`#${meterType}MeterForm`).style.display = 'block';
            
            // Update active tab
            $$('.meter-tab').forEach(tab => tab.classList.remove('active'));
            $(`.meter-tab[data-meter="${meterType}"]`).classList.add('active');
        }
        
        // Meter Entry
        function openMeterModal(officeId) {
            const office = AppState.data.offices.find(o => o.id === officeId);
            if (!office) return;
            
            $('#meterModalTitle').textContent = `${office.office_no} - Saya√ß Giri≈üi`;
            $('#currentOfficeId').value = officeId;
            
            // Reset form
            $('#electricReading').value = '';
            $('#waterReading').value = '';
            $('#gasReading').value = '';
            
            // Show first tab
            $$('.meter-tab').forEach(tab => tab.classList.remove('active'));
            $$('.meter-tab')[0].classList.add('active');
            $$('.meter-form').forEach(form => form.style.display = 'none');
            $('#electricMeterForm').style.display = 'block';
            
            showModal('meterModal');
        }

        function saveMeterReading() {
            const officeId = $('#currentOfficeId').value;
            const currentUser = AppState.data.currentUser;
            
            const activeTab = $('.meter-tab.active').dataset.meter;
            const readingInput = $(`#${activeTab}Reading`);
            const value = parseFloat(readingInput.value);
            
            if (isNaN(value) || value < 0) {
                showToast('Ge√ßerli bir deƒüer giriniz', 'error');
                return;
            }
            
            // Find office and update its history
            const offices = [...AppState.data.offices];
            const officeIndex = offices.findIndex(o => o.id === officeId);
            
            if (officeIndex === -1) return;
            
            const office = offices[officeIndex];
            const reading = {
                id: Date.now().toString(),
                officeId: officeId,
                type: activeTab,
                value: value,
                user: currentUser.fullName,
                date: new Date().toISOString()
            };
            
            // Update office's last reading
            if (activeTab === 'electric' && office.electric) {
                office.electric.last_reading = value;
            } else if (activeTab === 'water' && office.water) {
                office.water.last_reading = value;
            } else if (activeTab === 'gas' && office.gas) {
                office.gas.last_reading = value;
            }
            
            // Add to history
            if (!office.history) office.history = [];
            office.history.push({
                type: activeTab,
                value: value,
                user: currentUser.fullName,
                date: new Date().toISOString()
            });
            
            // Update global meter readings
            const meterReadings = [...AppState.data.meterReadings, reading];
            
            AppState.setState({ 
                offices: offices,
                meterReadings: meterReadings 
            });
            
            closeModal('meterModal');
            renderOffices();
            updateStats();
            showToast('Saya√ß deƒüeri kaydedildi', 'success');
        }

        // User Management
        function handleUserCreation(e) {
            e.preventDefault();
            
            const username = $('#newUsername').value.trim();
            const password = $('#newPassword').value.trim();
            const fullName = $('#newFullName').value.trim();
            const role = $('#newRole').value;
            
            // Check if username exists
            if (AppState.data.users.find(u => u.username === username)) {
                showToast('Bu kullanƒ±cƒ± adƒ± zaten kullanƒ±lƒ±yor', 'error');
                return;
            }
            
            const newUser = {
                username,
                password: hashPassword(password),
                fullName,
                role
            };
            
            const users = [...AppState.data.users, newUser];
            AppState.setState({ users });
            
            $('#userForm').reset();
            renderUsers();
            showToast('Kullanƒ±cƒ± ba≈üarƒ±yla eklendi', 'success');
        }

        function renderUsers() {
            const userList = $('#userList');
            const users = AppState.data.users;
            
            $('#userCount').textContent = `${users.length} Kullanƒ±cƒ±`;
            
            userList.innerHTML = users.map(user => `
                <div class="user-item">
                    <div class="user-item-info">
                        <div class="user-item-avatar">
                            ${user.fullName.charAt(0).toUpperCase()}
                        </div>
                        <div class="user-item-details">
                            <div class="user-item-name">${user.fullName}</div>
                            <div class="user-item-role">
                                ${user.role === 'admin' ? 'Y√∂netici' : 'Teknik Personel'}
                            </div>
                        </div>
                    </div>
                    <div class="user-item-actions">
                        ${user.username !== 'admin' ? `
                            <button class="btn btn-sm btn-outline" onclick="deleteUser('${user.username}')">
                                Sil
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function deleteUser(username) {
            if (confirm('Bu kullanƒ±cƒ±yƒ± silmek istediƒüinizden emin misiniz?')) {
                const users = AppState.data.users.filter(u => u.username !== username);
                AppState.setState({ users });
                renderUsers();
                showToast('Kullanƒ±cƒ± silindi', 'success');
            }
        }
        
        // Warehouse Management
        function renderWarehouses() {
            const warehouseSelect = $('#warehouseSelect');
            const productWarehouse = $('#productWarehouse');
            const warehouseList = $('#warehouseList');
            const warehouses = AppState.data.warehouses || [];
            
            // Update warehouse count
            $('#warehouseCount').textContent = `${warehouses.length} Depo`;
            
            // Clear existing options
            if (warehouseSelect) {
                const allOption = warehouseSelect.querySelector('option[value="all"]');
                warehouseSelect.innerHTML = '';
                if (allOption) warehouseSelect.appendChild(allOption);
                
                // Add warehouse options
                warehouses.forEach(warehouse => {
                    const option = document.createElement('option');
                    option.value = warehouse.id;
                    option.textContent = warehouse.name;
                    warehouseSelect.appendChild(option);
                });
            }
            
            // Update product modal warehouse dropdown
            if (productWarehouse) {
                productWarehouse.innerHTML = '';
                warehouses.forEach(warehouse => {
                    const option = document.createElement('option');
                    option.value = warehouse.id;
                    option.textContent = warehouse.name;
                    productWarehouse.appendChild(option);
                });
            }
            
            // Render warehouse list
            if (warehouseList) {
                warehouseList.innerHTML = warehouses.map(warehouse => `
                    <div class="user-item">
                        <div class="user-item-info">
                            <div class="user-item-avatar" style="background: var(--primary-color)">
                                üè¢
                            </div>
                            <div class="user-item-details">
                                <div class="user-item-name">${warehouse.name}</div>
                                <div class="user-item-role">${warehouse.description || 'Depo'}</div>
                            </div>
                        </div>
                        <div class="user-item-actions">
                            <button class="action-btn edit" onclick="editWarehouse('${warehouse.id}')">
                                ‚úèÔ∏è
                            </button>
                            <button class="action-btn delete" onclick="deleteWarehouse('${warehouse.id}')">
                                üóÆ
                            </button>
                        </div>
                    </div>
                `).join('');
            }
            
            renderInventory();
        }
        
        function handleWarehouseForm(e) {
            e.preventDefault();
            
            const name = $('#warehouseName').value.trim();
            const description = $('#warehouseDescription').value.trim();
            const warehouseId = $('#warehouseId').value;
            
            if (!name) {
                showToast('Depo adƒ± gereklidir', 'error');
                return;
            }
            
            if (warehouseId) {
                // Update existing warehouse
                const warehouses = [...AppState.data.warehouses];
                const index = warehouses.findIndex(w => w.id === warehouseId);
                
                if (index !== -1) {
                    warehouses[index] = { ...warehouses[index], name, description };
                    AppState.setState({ warehouses });
                    showToast('Depo g√ºncellendi', 'success');
                }
            } else {
                // Create new warehouse
                const newWarehouse = {
                    id: Date.now().toString(),
                    name,
                    description
                };
                
                const warehouses = [...(AppState.data.warehouses || []), newWarehouse];
                AppState.setState({ warehouses });
                showToast('Depo eklendi', 'success');
            }
            
            // Reset form
            $('#warehouseForm').reset();
            $('#warehouseId').value = '';
            $('#warehouseFormBtn').textContent = 'Depo Ekle';
            $('#warehouseFormReset').style.display = 'none';
            
            renderWarehouses();
        }
        
        function editWarehouse(warehouseId) {
            const warehouse = AppState.data.warehouses.find(w => w.id === warehouseId);
            if (!warehouse) return;
            
            $('#warehouseName').value = warehouse.name;
            $('#warehouseDescription').value = warehouse.description || '';
            $('#warehouseId').value = warehouse.id;
            $('#warehouseFormBtn').textContent = 'G√ºncelle';
            $('#warehouseFormReset').style.display = 'block';
        }
        
        function deleteWarehouse(warehouseId) {
            if (!confirm('Bu depoyu silmek istediƒüinizden emin misiniz?')) return;
            
            // Check if warehouse has inventory items
            const hasItems = AppState.data.inventory?.some(item => item.warehouseId === warehouseId);
            
            if (hasItems) {
                if (!confirm('Bu depoda √ºr√ºnler bulunuyor. Silmek istediƒüinizden emin misiniz?')) return;
                
                // Delete inventory items belonging to this warehouse
                const inventory = AppState.data.inventory.filter(item => item.warehouseId !== warehouseId);
                AppState.setState({ inventory });
            }
            
            const warehouses = AppState.data.warehouses.filter(w => w.id !== warehouseId);
            AppState.setState({ warehouses });
            
            showToast('Depo silindi', 'success');
            renderWarehouses();
        }
        
        // Inventory Management
        function renderInventory() {
            const inventoryTableBody = $('#inventoryTableBody');
            const warehouseSelect = $('#warehouseSelect');
            const searchTerm = $('#inventorySearch')?.value?.toLowerCase() || '';
            
            if (!inventoryTableBody) return;
            
            let filteredInventory = AppState.data.inventory || [];
            const selectedWarehouse = warehouseSelect?.value;
            
            // Filter by warehouse
            if (selectedWarehouse && selectedWarehouse !== 'all') {
                filteredInventory = filteredInventory.filter(item => item.warehouseId === selectedWarehouse);
            }
            
            // Filter by search term
            if (searchTerm) {
                filteredInventory = filteredInventory.filter(item => 
                    item.code.toLowerCase().includes(searchTerm) ||
                    item.name.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))
                );
            }
            
            // Render inventory table
            inventoryTableBody.innerHTML = filteredInventory.length > 0 ? 
                filteredInventory.map(item => {
                    const warehouse = AppState.data.warehouses.find(w => w.id === item.warehouseId);
                    
                    return `
                        <tr>
                            <td>${item.code}</td>
                            <td>${item.name}</td>
                            <td>${warehouse ? warehouse.name : '-'}</td>
                            <td>${item.quantity} ${item.unit}</td>
                            <td>${item.unit}</td>
                            <td>${formatDateTime(item.updatedAt)}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn edit" onclick="editProduct('${item.id}')">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="action-btn" onclick="viewProductHistory('${item.id}')">
                                        üìÉ
                                    </button>
                                    <button class="action-btn delete" onclick="deleteProduct('${item.id}')">
                                        üóÆ
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('') : 
                `<tr><td colspan="7" style="text-align: center;">Kayƒ±t bulunamadƒ±</td></tr>`;
        }

        // Event Listeners
        function setupEventListeners() {
            // Login form
            $('#loginForm').addEventListener('submit', handleLogin);
            
            // Logout
            $('#logoutBtn').addEventListener('click', handleLogout);
            
            // Theme toggle
            $('#themeToggle').addEventListener('click', () => {
                const currentTheme = AppState.data.currentTheme;
                setTheme(currentTheme === 'light' ? 'dark' : 'light');
            });
            
            // User menu
            $('#userInfo').addEventListener('click', () => {
                $('#userDropdown').classList.toggle('show');
            });
            
            // Main tabs
            $$('#mainTabs .tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    if (tabId) {
                        changeTab(tabId);
                    }
                });
            });
            
            // Warehouse subtabs
            $$('.tabs [data-tab]').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    if (tabId && tabId !== 'offices' && tabId !== 'stats' && tabId !== 'warehouse') {
                        // Hide all subtabs
                        $$('.warehouse-subtab').forEach(content => {
                            content.style.display = 'none';
                        });
                        
                        // Show selected subtab
                        $(`#${tabId}Content`).style.display = 'block';
                        
                        // Update active tab
                        tab.parentNode.querySelectorAll('.tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                    }
                });
            });
            
            // Warehouse form
            const warehouseForm = $('#warehouseForm');
            if (warehouseForm) {
                warehouseForm.addEventListener('submit', handleWarehouseForm);
            }
            
            // Reset warehouse form
            const warehouseFormReset = $('#warehouseFormReset');
            if (warehouseFormReset) {
                warehouseFormReset.addEventListener('click', () => {
                    $('#warehouseForm').reset();
                    $('#warehouseId').value = '';
                    $('#warehouseFormBtn').textContent = 'Depo Ekle';
                    $('#warehouseFormReset').style.display = 'none';
                });
            }
            
            // Add warehouse button
            $('#addWarehouseBtn')?.addEventListener('click', () => {
                showModal('warehouseModal');
                $('#warehouseModalTitle').textContent = 'Yeni Depo Ekle';
                $('#warehouseId').value = '';
                $('#warehouseName').value = '';
                $('#warehouseLocation').value = '';
                $('#warehouseDescription').value = '';
            });
            
            // Add product button
            $('#addProductBtn')?.addEventListener('click', () => {
                showModal('productModal');
                $('#productModalTitle').textContent = 'Yeni √úr√ºn Ekle';
                $('#productId').value = '';
                $('#productName').value = '';
                $('#productCode').value = '';
                $('#productQuantity').value = '0';
                $('#productUnit').value = 'Adet';
                
                // Populate warehouse dropdown
                const warehouseSelect = $('#productWarehouse');
                if (warehouseSelect) {
                    warehouseSelect.innerHTML = '';
                    
                    // Add empty option
                    const emptyOption = document.createElement('option');
                    emptyOption.value = '';
                    emptyOption.textContent = 'Depo Se√ßiniz';
                    warehouseSelect.appendChild(emptyOption);
                    
                    // Add warehouse options
                    AppState.data.warehouses.forEach(warehouse => {
                        const option = document.createElement('option');
                        option.value = warehouse.id;
                        option.textContent = warehouse.name;
                        warehouseSelect.appendChild(option);
                    });
                }
            });
            
            // Inventory search
            const inventorySearch = $('#inventorySearch');
            if (inventorySearch) {
                inventorySearch.addEventListener('input', renderInventory);
            }
            
            // Warehouse select filter
            const warehouseSelect = $('#warehouseSelect');
            if (warehouseSelect) {
                warehouseSelect.addEventListener('change', renderInventory);
            }
            
            // Add product button
            const addProductBtn = $('#addProductBtn');
            if (addProductBtn) {
                addProductBtn.addEventListener('click', () => openProductModal());
            }
            
            // Save product button
            const saveProductBtn = $('#saveProductBtn');
            if (saveProductBtn) {
                saveProductBtn.addEventListener('click', saveProduct);
            }
            
            // Export inventory button
            const exportInventoryBtn = $('#exportInventoryBtn');
            if (exportInventoryBtn) {
                exportInventoryBtn.addEventListener('click', exportInventory);
            }
            
            // Excel import/export buttons
            const downloadTemplateBtn = $('#downloadTemplateBtn');
            if (downloadTemplateBtn) {
                downloadTemplateBtn.addEventListener('click', downloadTemplate);
            }
            
            const exportInventoryReportBtn = $('#exportInventoryReportBtn');
            if (exportInventoryReportBtn) {
                exportInventoryReportBtn.addEventListener('click', exportInventory);
            }
            
            const exportMeterReportBtn = $('#exportMeterReportBtn');
            if (exportMeterReportBtn) {
                exportMeterReportBtn.addEventListener('click', () => {
                    showToast('Saya√ß verileri Excel olarak indiriliyor...', 'success');
                });
            }
            
            // Excel file input
            const excelFileInput = $('#excelFileInput');
            if (excelFileInput) {
                excelFileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        showToast('Excel dosyasƒ± y√ºkleniyor...', 'success');
                        // In a real implementation, we would process the Excel file here
                        setTimeout(() => {
                            showToast('Excel verisi ba≈üarƒ±yla i√ße aktarƒ±ldƒ±', 'success');
                            e.target.value = '';
                        }, 1500);
                    }
                });
            }
            
            // User management
            $('#userManagementBtn').addEventListener('click', () => {
                $('#userDropdown').classList.remove('show');
                showUserManagement();
            });
            
            // Tabs
            $$('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    switchTab(tabName);
                });
            });
            
            // Meter tabs
            const meterTabs = $$('.meter-tab');
            if (meterTabs.length > 0) {
                meterTabs.forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        // Remove active class from all tabs
                        meterTabs.forEach(t => t.classList.remove('active'));
                        // Add active class to clicked tab
                        tab.classList.add('active');
                        
                        const meterType = tab.getAttribute('data-meter');
                        if (meterType) {
                            // Hide all meter forms
                            $$('.meter-form').forEach(form => form.style.display = 'none');
                            // Show selected meter form
                            const selectedForm = $(`#${meterType}MeterForm`);
                            if (selectedForm) {
                                selectedForm.style.display = 'block';
                            }
                        }
                    });
                });
            }
            
            // Office search
            $('#officeSearch').addEventListener('input', () => {
                renderOffices();
            });
            
            // User form
            $('#userForm').addEventListener('submit', handleUserCreation);
            
            // Close modals on outside click
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('show');
                }
                
                // Close user dropdown
                if (!e.target.closest('.user-menu')) {
                    $('#userDropdown').classList.remove('show');
                }
            });
        }

        function switchTab(tabName) {
            // Update tab active state
            $$('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });
            
            // Show/hide content
            $$('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            $(`#${tabName}Tab`).style.display = 'block';
            
            // Update content
            if (tabName === 'stats') {
                updateStats();
            }
        }

        function showUserManagement() {
            // Hide all tab contents
            $$('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Show user management tab content
            $('#userManagementTab').style.display = 'block';
            
            // Update active class on tabs
            $$('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            renderUsers();
        }

        // Initialize Application
        function initializeApp() {
            try {
                // First initialize default users
                initializeUsers();
                
                // Then load saved state (but preserve users if empty)
                const savedUsers = [...AppState.data.users];
                AppState.loadFromLocalStorage();
                
                // If no users in saved state, restore default users
                if (!AppState.data.users || AppState.data.users.length === 0) {
                    AppState.setState({ users: savedUsers });
                }
                
                // Initialize warehouses if not exists
                if (!AppState.data.warehouses || AppState.data.warehouses.length === 0) {
                    initializeWarehouses();
                }
                
                // Initialize inventory if not exists
                if (!AppState.data.inventory) {
                    AppState.setState({ inventory: [] });
                }
                
                // Initialize meter readings if not exists
                if (!AppState.data.meterReadings) {
                    AppState.setState({ meterReadings: [] });
                }
                
                // Apply theme
                setTheme(AppState.data.currentTheme);
                
                // Load offices
                loadOffices();
                
                // Setup event listeners
                setupEventListeners();
                
                // Check if user is logged in
                if (AppState.data.currentUser) {
                    showDashboard();
                } else {
                    showLoginPage();
                }
            } catch (error) {
                console.error('Initialization error:', error);
            } finally {
                // Hide loading screen
                setTimeout(() => {
                    const loadingScreen = $('#loadingScreen');
                    if (loadingScreen) {
                        loadingScreen.style.opacity = '0';
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                        }, 300);
                    }
                }, 500);
            }
        }

        // Clear Local Storage
        function clearLocalStorage() {
            if (confirm('T√ºm kayƒ±tlƒ± veriler silinecek. Emin misiniz?')) {
                localStorage.removeItem('appState');
                location.reload();
            }
        }

        // Show History Modal
        function openHistoryModal(officeId) {
            const office = AppState.data.offices.find(o => o.id === officeId);
            if (!office) return;
            
            $('#historyModalTitle').textContent = `${office.number || office.office_no} Saya√ß Ge√ßmi≈üi`;
            
            const historyContent = $('#historyContent');
            historyContent.innerHTML = '';
            
            const readings = AppState.data.meterReadings.filter(r => r.officeId === officeId);
            if (!readings || readings.length === 0) {
                historyContent.innerHTML = '<p class="text-center">Hen√ºz kayƒ±t bulunmuyor.</p>';
                showModal('historyModal');
                return;
            }
            
            // Group readings by type
            const electricReadings = readings.filter(r => r.type === 'electric').sort((a, b) => new Date(b.date) - new Date(a.date));
            const waterReadings = readings.filter(r => r.type === 'water').sort((a, b) => new Date(b.date) - new Date(a.date));
            const gasReadings = readings.filter(r => r.type === 'gas').sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Create HTML for tabs
            let html = `
                <div class="meter-tabs history-tabs">
                    <div class="meter-tab active" data-history="electric" onclick="switchHistoryTab('electric')">
                        <span>‚ö°</span> Elektrik
                    </div>
                    <div class="meter-tab" data-history="water" onclick="switchHistoryTab('water')">
                        <span>üíß</span> Su
                    </div>
                    <div class="meter-tab" data-history="gas" onclick="switchHistoryTab('gas')">
                        <span>üî•</span> Doƒüalgaz
                    </div>
                </div>
            `;
            
            // Create HTML for tab contents
            html += `<div id="electricHistoryTab" class="history-tab-content">`;
            if (electricReadings.length === 0) {
                html += '<p class="text-center">Hen√ºz elektrik saya√ß kaydƒ± bulunmuyor.</p>';
            } else {
                html += `
                    <div class="table-responsive">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Deƒüer (kWh)</th>
                                    <th>Personel</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                electricReadings.forEach(reading => {
                    html += `
                        <tr>
                            <td>${formatDateTime(reading.date)}</td>
                            <td>${reading.value}</td>
                            <td>${reading.user}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            html += `</div>`;
            
            html += `<div id="waterHistoryTab" class="history-tab-content" style="display: none;">`;
            if (waterReadings.length === 0) {
                html += '<p class="text-center">Hen√ºz su saya√ß kaydƒ± bulunmuyor.</p>';
            } else {
                html += `
                    <div class="table-responsive">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Deƒüer (m¬≥)</th>
                                    <th>Personel</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                waterReadings.forEach(reading => {
                    html += `
                        <tr>
                            <td>${formatDateTime(reading.date)}</td>
                            <td>${reading.value}</td>
                            <td>${reading.user}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            html += `</div>`;
            
            html += `<div id="gasHistoryTab" class="history-tab-content" style="display: none;">`;
            if (gasReadings.length === 0) {
                html += '<p class="text-center">Hen√ºz doƒüalgaz saya√ß kaydƒ± bulunmuyor.</p>';
            } else {
                html += `
                    <div class="table-responsive">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Deƒüer (m¬≥)</th>
                                    <th>Personel</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                gasReadings.forEach(reading => {
                    html += `
                        <tr>
                            <td>${formatDateTime(reading.date)}</td>
                            <td>${reading.value}</td>
                            <td>${reading.user}</td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
            }
            html += `</div>`;
            
            historyContent.innerHTML = html;
            showModal('historyModal');
        }
        
        // Switch between history tabs
        function switchHistoryTab(type) {
            // Hide all history content
            $$('.history-tab-content').forEach(tab => tab.style.display = 'none');
            
            // Show selected tab
            $(`#${type}HistoryTab`).style.display = 'block';
            
            // Update active tab
            $$('.history-tabs .meter-tab').forEach(tab => tab.classList.remove('active'));
            $(`.meter-tab[data-history="${type}"]`).classList.add('active');
        }

        // Make functions global for onclick handlers
        window.closeModal = closeModal;
        window.openMeterModal = openMeterModal;
        window.saveMeterReading = saveMeterReading;
        window.deleteUser = deleteUser;
        window.showHistory = showHistory;
        window.clearLocalStorage = clearLocalStorage;
        window.switchHistoryTab = switchHistoryTab;
        window.openHistoryModal = openHistoryModal;

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }
    </script>
</body>
</html>
